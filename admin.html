<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïπ≠Ï∞¨Ïπ¥ÎìúÍ≤åÏûÑ - Í¥ÄÎ¶¨Ïûê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255,255,255,0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #667eea;
        }

        .header p {
            color: #666;
        }

        .nav-tabs {
            display: flex;
            background: rgba(255,255,255,0.9);
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            color: #666;
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
        }

        .form-textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #6c757d, #5a6268);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #218838);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* ÎØ∏ÏÖò Í¥ÄÎ¶¨ */
        .mission-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
        }

        .mission-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            background: #f8f9fa;
            margin-bottom: 10px;
            border-radius: 8px;
        }

        .mission-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .mission-text {
            flex: 1;
            margin-right: 15px;
            font-size: 0.95rem;
        }

        .mission-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        /* Í≤åÏûÑÎ∞© ÌòÑÌô© */
        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .room-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border-left: 5px solid #667eea;
        }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .room-code {
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
        }

        .room-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-waiting {
            background: #ffc107;
            color: #856404;
        }

        .status-playing {
            background: #28a745;
            color: white;
        }

        .status-finished {
            background: #6c757d;
            color: white;
        }

        .room-players {
            margin-bottom: 10px;
        }

        .player-name {
            display: inline-block;
            background: #e9ecef;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin: 2px;
        }

        .player-name.host {
            background: #ffd700;
            color: #333;
        }

        .player-name.ai {
            background: #6c757d;
            color: white;
        }

        .room-info {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        /* ÌÜµÍ≥Ñ Ïπ¥Îìú */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 4px solid #667eea;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 1rem;
        }

        /* Í≤åÏûÑ ÏÑ§Ï†ï */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .setting-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .setting-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .setting-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
        }

        /* Î°úÎî© Î∞è Î©îÏãúÏßÄ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .message.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* Î∞òÏùëÌòï */
        @media (max-width: 768px) {
            .admin-container {
                padding: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .rooms-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Ìó§Îçî -->
        <div class="header">
            <h1>üéâ Ïπ≠Ï∞¨Ïπ¥ÎìúÍ≤åÏûÑ Í¥ÄÎ¶¨Ïûê</h1>
            <p>Í≤åÏûÑ ÌòÑÌô©ÏùÑ Î™®ÎãàÌÑ∞ÎßÅÌïòÍ≥† ÏÑ§Ï†ïÏùÑ Í¥ÄÎ¶¨ÌïòÏÑ∏Ïöî</p>
        </div>

        <!-- ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò ÌÉ≠ -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">ÎåÄÏãúÎ≥¥Îìú</button>
            <button class="nav-tab" onclick="showTab('missions')">ÎØ∏ÏÖò Í¥ÄÎ¶¨</button>
            <button class="nav-tab" onclick="showTab('rooms')">Í≤åÏûÑÎ∞© ÌòÑÌô©</button>
            <button class="nav-tab" onclick="showTab('settings')">Í≤åÏûÑ ÏÑ§Ï†ï</button>
        </div>

        <!-- Î©îÏãúÏßÄ ÏòÅÏó≠ -->
        <div id="messageArea"></div>

        <!-- ÎåÄÏãúÎ≥¥Îìú ÌÉ≠ -->
        <div id="dashboard" class="tab-content active">
            <!-- ÌÜµÍ≥Ñ Ïπ¥Îìú -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalRooms">-</div>
                    <div class="stat-label">Ï†ÑÏ≤¥ Í≤åÏûÑÎ∞©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeRooms">-</div>
                    <div class="stat-label">ÏßÑÌñâ Ï§ëÏù∏ Í≤åÏûÑ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalPlayers">-</div>
                    <div class="stat-label">Ï¥ù ÌîåÎ†àÏù¥Ïñ¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalMissions">-</div>
                    <div class="stat-label">Îì±Î°ùÎêú ÎØ∏ÏÖò</div>
                </div>
            </div>

            <!-- ÏµúÍ∑º ÌôúÎèô -->
            <div class="card">
                <h2>üìä Ïã§ÏãúÍ∞Ñ ÌòÑÌô©</h2>
                <div id="realtimeStatus">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÎØ∏ÏÖò Í¥ÄÎ¶¨ ÌÉ≠ -->
        <div id="missions" class="tab-content">
            <div class="card">
                <h2>üìù ÏÉà ÎØ∏ÏÖò Ï∂îÍ∞Ä</h2>
                <div class="form-group">
                    <label class="form-label" for="missionText">ÎØ∏ÏÖò ÎÇ¥Ïö©</label>
                    <textarea id="missionText" class="form-textarea" placeholder="Ïòà: ÎÇ¥Í∞Ä Ïñ¥Î†§Ïö¥ ÏÉÅÌô©ÏóêÏÑú Ïπ®Ï∞©ÌïòÍ≤å ÎåÄÏ≤òÌñàÎçò ÏàúÍ∞ÑÏùÄ?"></textarea>
                </div>
                <button class="btn btn-primary" onclick="addMission()">ÎØ∏ÏÖò Ï∂îÍ∞Ä</button>
                <button class="btn btn-secondary" onclick="clearMissionForm()">Ï¥àÍ∏∞Ìôî</button>
            </div>

            <div class="card">
                <h2>üìã ÎØ∏ÏÖò Î™©Î°ù</h2>
                <div id="missionsList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>ÎØ∏ÏÖòÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Í≤åÏûÑÎ∞© ÌòÑÌô© ÌÉ≠ -->
        <div id="rooms" class="tab-content">
            <div class="card">
                <h2>üéÆ Í≤åÏûÑÎ∞© ÌòÑÌô©</h2>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="refreshRooms()">ÏÉàÎ°úÍ≥†Ïπ®</button>
                    <button class="btn btn-danger" onclick="cleanupFinishedRooms()">ÏôÑÎ£åÎêú Í≤åÏûÑÎ∞© Ï†ïÎ¶¨</button>
                </div>
                <div id="roomsList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>Í≤åÏûÑÎ∞©ÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Í≤åÏûÑ ÏÑ§Ï†ï ÌÉ≠ -->
        <div id="settings" class="tab-content">
            <div class="card">
                <h2>‚öôÔ∏è Í≤åÏûÑ ÏÑ§Ï†ï</h2>
                <div class="settings-grid">
                    <div class="setting-item">
                        <div class="setting-title">ÏµúÎåÄ ÌîåÎ†àÏù¥Ïñ¥ Ïàò</div>
                        <div class="setting-description">Ìïú Í≤åÏûÑÎ∞©Îãπ ÏµúÎåÄ Ï∞∏Í∞Ä Í∞ÄÎä•Ìïú ÌîåÎ†àÏù¥Ïñ¥ Ïàò</div>
                        <input type="number" id="maxPlayers" class="form-input" value="6" min="4" max="10">
                        <button class="btn btn-primary btn-small" onclick="updateSetting('maxPlayers')">Ï†ÄÏû•</button>
                    </div>

                    <div class="setting-item">
                        <div class="setting-title">ÏµúÎåÄ ÎùºÏö¥Îìú Ïàò</div>
                        <div class="setting-description">Í≤åÏûÑÎãπ ÏßÑÌñâÌï† ÏµúÎåÄ ÎùºÏö¥Îìú Ïàò</div>
                        <input type="number" id="maxRounds" class="form-input" value="5" min="3" max="10">
                        <button class="btn btn-primary btn-small" onclick="updateSetting('maxRounds')">Ï†ÄÏû•</button>
                    </div>

                    <div class="setting-item">
                        <div class="setting-title">AI Î¥á ÏûêÎèô Ï∂îÍ∞Ä</div>
                        <div class="setting-description">Ïù∏Ïõê Î∂ÄÏ°± Ïãú AI Î¥á ÏûêÎèô Ï∂îÍ∞Ä Ïó¨Î∂Ä</div>
                        <select id="autoAI" class="form-input">
                            <option value="true">ÌôúÏÑ±Ìôî</option>
                            <option value="false">ÎπÑÌôúÏÑ±Ìôî</option>
                        </select>
                        <button class="btn btn-primary btn-small" onclick="updateSetting('autoAI')">Ï†ÄÏû•</button>
                    </div>

                    <div class="setting-item">
                        <div class="setting-title">Ïπ¥Îìú Ï¢ÖÎ•òÎ≥Ñ Í∞úÏàò</div>
                        <div class="setting-description">Í∞Å Ïπ¥Îìú Ï¢ÖÎ•òÎ≥Ñ 1~5Î≤à Ïπ¥Îìú Í∞úÏàò</div>
                        <input type="number" id="cardsPerType" class="form-input" value="5" min="3" max="7">
                        <button class="btn btn-primary btn-small" onclick="updateSetting('cardsPerType')">Ï†ÄÏû•</button>
                    </div>
                </div>
            </div>

                <div class="card">
                    <h2>üóÉÔ∏è Îç∞Ïù¥ÌÑ∞ Í¥ÄÎ¶¨</h2>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="exportGameData()">Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
                        <button class="btn btn-danger" onclick="clearOldData()">Ïò§ÎûòÎêú Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨</button>
                        <button class="btn btn-success" onclick="backupData()">Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ</button>
                        <button class="btn btn-danger" onclick="resetAllGames()" style="background: linear-gradient(45deg, #ff4757, #ff3838);">üö® Î™®Îì† Í≤åÏûÑ Î¶¨ÏÖã</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script>
        // Firebase ÏÑ§Ï†ï
        const firebaseConfig = {
            apiKey: "AIzaSyC3IwL7hYsWIT6wRpenGXwqvSBtV_WIx-M",
            authDomain: "complimentcardgame.firebaseapp.com",
            projectId: "complimentcardgame",
            storageBucket: "complimentcardgame.firebasestorage.app",
            messagingSenderId: "766205964734",
            appId: "1:766205964734:web:0aa711ffc46f96e51889ef",
            measurementId: "G-P7KM5ETH2J"
        };

        // Firebase Ï¥àÍ∏∞Ìôî
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let currentUser = null;
        let gameRooms = [];
        let missions = [];
        let realtimeListener = null;

        // Í∏∞Î≥∏ ÎØ∏ÏÖò Îç∞Ïù¥ÌÑ∞
        const defaultMissions = [
            "ÎÇ¥Í∞Ä Ïñ¥Î†§Ïö¥ ÏÉÅÌô©ÏóêÏÑú Ïπ®Ï∞©ÌïòÍ≤å ÎåÄÏ≤òÌñàÎçò ÏàúÍ∞ÑÏùÄ?",
            "ÎÇ¥Í∞Ä ÌåÄÏõêÎì§ÏóêÍ≤å ÎèÑÏõÄÏù¥ ÎêòÏóàÎçò Í≤ΩÌóòÏùÄ?",
            "ÎÇ¥Í∞Ä Ï∞ΩÏùòÏ†ÅÏù∏ ÏïÑÏù¥ÎîîÏñ¥Î•º Ï†úÏãúÌñàÎçò ÎïåÎäî?",
            "ÎÇ¥Í∞Ä Î¶¨ÎçîÏã≠ÏùÑ Î∞úÌúòÌñàÎçò Î™®ÏäµÏùÄ?",
            "ÎÇ¥Í∞Ä ÍººÍººÌïòÍ≥† Ï±ÖÏûÑÍ∞ê ÏûàÍ≤å ÏùºÌñàÎçò Í≤ΩÏö∞Îäî?",
            "ÎÇ¥Í∞Ä Í∏çÏ†ïÏ†ÅÏù∏ ÏóêÎÑàÏßÄÎ•º Ï†ÑÎã¨ÌñàÎçò ÏàúÍ∞ÑÏùÄ?",
            "ÎÇ¥Í∞Ä Î¨∏Ï†ú Ìï¥Í≤∞ Îä•Î†•ÏùÑ Î≥¥Ïó¨Ï§Ä ÏÇ¨Î°ÄÎäî?",
            "ÎÇ¥Í∞Ä ÏÜåÌÜµÏùÑ ÏûòÌñàÎçò Í≤ΩÌóòÏùÄ?",
            "ÎÇ¥Í∞Ä ÏÑ±Ïû•ÌïòÎäî Î™®ÏäµÏùÑ Î≥¥Ïó¨Ï§Ä ÎïåÎäî?",
            "ÎÇ¥Í∞Ä Î∞∞Î†§Ïã¨ÏùÑ Î∞úÌúòÌñàÎçò ÏàúÍ∞ÑÏùÄ?",
            "ÎÇ¥Í∞Ä ÎèôÎ£åÎì§ÏùÑ Í≤©Î†§ÌñàÎçò Í≤ΩÌóòÏùÄ?",
            "ÎÇ¥Í∞Ä ÏÉàÎ°úÏö¥ Í≤ÉÏùÑ ÌïôÏäµÌïòÎäî Î™®ÏäµÏùÑ Î≥¥Ïó¨Ï§Ä ÎïåÎäî?",
            "ÎÇ¥Í∞Ä Ï±ÖÏûÑÍ∞ê ÏûàÍ≤å ÏóÖÎ¨¥Î•º ÎßàÎ¨¥Î¶¨Ìïú Í≤ΩÌóòÏùÄ?",
            "ÎÇ¥Í∞Ä ÌåÄÏõåÌÅ¨Î•º Î∞úÌúòÌñàÎçò ÏàúÍ∞ÑÏùÄ?",
            "ÎÇ¥Í∞Ä Ïú†Î®∏Î°ú Î∂ÑÏúÑÍ∏∞Î•º Ï¢ãÍ≤å ÎßåÎì† Í≤ΩÌóòÏùÄ?",
            "ÎÇ¥Í∞Ä Îã§Î•∏ ÏÇ¨ÎûåÏùò ÏùòÍ≤¨ÏùÑ Ïûò Îì§Ïñ¥Ï§Ä ÎïåÎäî?",
            "ÎÇ¥Í∞Ä Ïä§Ìä∏Î†àÏä§ ÏÉÅÌô©ÏóêÏÑúÎèÑ Í∏çÏ†ïÏ†ÅÏúºÎ°ú ÎåÄÏ≤òÌïú Í≤ΩÌóòÏùÄ?",
            "ÎÇ¥Í∞Ä ÏÉàÎ°úÏö¥ ÎèÑÏ†ÑÏùÑ ÎëêÎ†§ÏõåÌïòÏßÄ ÏïäÏïòÎçò ÏàúÍ∞ÑÏùÄ?",
            "ÎÇ¥Í∞Ä Îã§Î•∏ ÏÇ¨ÎûåÏùÑ ÏúÑÌï¥ ÏñëÎ≥¥ÌñàÎçò Í≤ΩÌóòÏùÄ?",
            "ÎÇ¥Í∞Ä Î™©ÌëúÎ•º Îã¨ÏÑ±ÌïòÍ∏∞ ÏúÑÌï¥ ÎÅàÍ∏∞ÏûàÍ≤å ÎÖ∏Î†•Ìïú ÏÇ¨Î°ÄÎäî?"
        ];

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // ÏùµÎ™Ö Î°úÍ∑∏Ïù∏
                await auth.signInAnonymously();
                currentUser = auth.currentUser;
                
                // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
                await initializeData();
                loadDashboard();
                loadMissions();
                loadRooms();
                
                // Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑà ÏãúÏûë
                startRealtimeListener();
                
            } catch (error) {
                console.error('Ï¥àÍ∏∞Ìôî Ïò§Î•ò:', error);
                showMessage('Ï¥àÍ∏∞ÌôîÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            }
        });

        // Îç∞Ïù¥ÌÑ∞ Ï¥àÍ∏∞Ìôî
        async function initializeData() {
            // ÎØ∏ÏÖò Ïª¨Î†âÏÖòÏù¥ ÎπÑÏñ¥ÏûàÏúºÎ©¥ Í∏∞Î≥∏ ÎØ∏ÏÖò Ï∂îÍ∞Ä
            const missionsSnapshot = await db.collection('missions').limit(1).get();
            if (missionsSnapshot.empty) {
                const batch = db.batch();
                defaultMissions.forEach((mission, index) => {
                    const docRef = db.collection('missions').doc();
                    batch.set(docRef, {
                        text: mission,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        order: index + 1
                    });
                });
                await batch.commit();
                showMessage('Í∏∞Î≥∏ ÎØ∏ÏÖòÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.', 'success');
            }
        }

        // ÌÉ≠ Ï†ÑÌôò
        function showTab(tabName) {
            // ÌÉ≠ Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ÌÉ≠ ÏΩòÌÖêÏ∏† ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            // ÌÉ≠Î≥Ñ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'missions':
                    loadMissions();
                    break;
                case 'rooms':
                    loadRooms();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }

        // ÎåÄÏãúÎ≥¥Îìú Î°úÎìú
        async function loadDashboard() {
            try {
                // Í≤åÏûÑÎ∞© Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                const roomsSnapshot = await db.collection('games').get();
                const rooms = roomsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                // ÎØ∏ÏÖò Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                const missionsSnapshot = await db.collection('missions').get();
                
                // ÌÜµÍ≥Ñ Í≥ÑÏÇ∞
                const totalRooms = rooms.length;
                const activeRooms = rooms.filter(room => room.status === 'playing').length;
                const totalPlayers = rooms.reduce((sum, room) => 
                    sum + (room.players ? room.players.filter(p => !p.isAI).length : 0), 0);
                const totalMissions = missionsSnapshot.size;
                
                // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
                document.getElementById('totalRooms').textContent = totalRooms;
                document.getElementById('activeRooms').textContent = activeRooms;
                document.getElementById('totalPlayers').textContent = totalPlayers;
                document.getElementById('totalMissions').textContent = totalMissions;
                
                // Ïã§ÏãúÍ∞Ñ ÌòÑÌô© ÏóÖÎç∞Ïù¥Ìä∏
                updateRealtimeStatus(rooms);
                
            } catch (error) {
                console.error('ÎåÄÏãúÎ≥¥Îìú Î°úÎìú Ïò§Î•ò:', error);
                showMessage('ÎåÄÏãúÎ≥¥Îìú Î°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // Ïã§ÏãúÍ∞Ñ ÌòÑÌô© ÏóÖÎç∞Ïù¥Ìä∏
        function updateRealtimeStatus(rooms) {
            const statusEl = document.getElementById('realtimeStatus');
            
            if (rooms.length === 0) {
                statusEl.innerHTML = '<div class="message info">ÌòÑÏû¨ ÏßÑÌñâ Ï§ëÏù∏ Í≤åÏûÑÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }
            
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">';
            
            rooms.filter(room => room.status === 'playing').slice(0, 6).forEach(room => {
                const humanPlayers = room.players ? room.players.filter(p => !p.isAI) : [];
                const aiPlayers = room.players ? room.players.filter(p => p.isAI) : [];
                
                html += `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
                        <div style="font-weight: bold; color: #28a745; margin-bottom: 8px;">Î∞© ${room.roomCode}</div>
                        <div style="font-size: 0.9rem; color: #666;">
                            üë• ${humanPlayers.length}Î™Ö + ü§ñ ${aiPlayers.length}Î™Ö<br>
                            üèÜ ÎùºÏö¥Îìú ${room.currentRound || 1}<br>
                            ‚è∞ ${formatTime(room.startedAt)}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            statusEl.innerHTML = html;
        }

        // ÎØ∏ÏÖò Í¥ÄÎ¶¨ Î°úÎìú
        async function loadMissions() {
            try {
                const snapshot = await db.collection('missions').orderBy('order', 'asc').get();
                missions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                updateMissionsList();
                
            } catch (error) {
                console.error('ÎØ∏ÏÖò Î°úÎìú Ïò§Î•ò:', error);
                showMessage('ÎØ∏ÏÖò Î°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // ÎØ∏ÏÖò Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
        function updateMissionsList() {
            const listEl = document.getElementById('missionsList');
            
            if (missions.length === 0) {
                listEl.innerHTML = '<div class="message info">Îì±Î°ùÎêú ÎØ∏ÏÖòÏù¥ ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }
            
            let html = '<div class="mission-list">';
            missions.forEach((mission, index) => {
                html += `
                    <div class="mission-item">
                        <div class="mission-text">${mission.text}</div>
                        <div class="mission-actions">
                            <button class="btn btn-secondary btn-small" onclick="editMission('${mission.id}')">ÏàòÏ†ï</button>
                            <button class="btn btn-danger btn-small" onclick="deleteMission('${mission.id}')">ÏÇ≠Ï†ú</button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            listEl.innerHTML = html;
        }

        // ÎØ∏ÏÖò Ï∂îÍ∞Ä
        async function addMission() {
            const text = document.getElementById('missionText').value.trim();
            if (!text) {
                showMessage('ÎØ∏ÏÖò ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
                return;
            }
            
            try {
                await db.collection('missions').add({
                    text: text,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    order: missions.length + 1
                });
                
                showMessage('ÎØ∏ÏÖòÏù¥ Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.', 'success');
                clearMissionForm();
                loadMissions();
                
            } catch (error) {
                console.error('ÎØ∏ÏÖò Ï∂îÍ∞Ä Ïò§Î•ò:', error);
                showMessage('ÎØ∏ÏÖò Ï∂îÍ∞ÄÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // ÎØ∏ÏÖò ÏÇ≠Ï†ú
        async function deleteMission(missionId) {
            if (!confirm('Ï†ïÎßêÎ°ú Ïù¥ ÎØ∏ÏÖòÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            
            try {
                await db.collection('missions').doc(missionId).delete();
                showMessage('ÎØ∏ÏÖòÏù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', 'success');
                loadMissions();
                
            } catch (error) {
                console.error('ÎØ∏ÏÖò ÏÇ≠Ï†ú Ïò§Î•ò:', error);
                showMessage('ÎØ∏ÏÖò ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // ÎØ∏ÏÖò ÏàòÏ†ï
        async function editMission(missionId) {
            const mission = missions.find(m => m.id === missionId);
            if (!mission) return;
            
            const newText = prompt('ÎØ∏ÏÖò ÎÇ¥Ïö©ÏùÑ ÏàòÏ†ïÌïòÏÑ∏Ïöî:', mission.text);
            if (!newText || newText.trim() === mission.text) return;
            
            try {
                await db.collection('missions').doc(missionId).update({
                    text: newText.trim(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                showMessage('ÎØ∏ÏÖòÏù¥ ÏàòÏ†ïÎêòÏóàÏäµÎãàÎã§.', 'success');
                loadMissions();
                
            } catch (error) {
                console.error('ÎØ∏ÏÖò ÏàòÏ†ï Ïò§Î•ò:', error);
                showMessage('ÎØ∏ÏÖò ÏàòÏ†ïÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // ÎØ∏ÏÖò Ìèº Ï¥àÍ∏∞Ìôî
        function clearMissionForm() {
            document.getElementById('missionText').value = '';
        }

        // Í≤åÏûÑÎ∞© ÌòÑÌô© Î°úÎìú
        async function loadRooms() {
            try {
                const snapshot = await db.collection('games').orderBy('createdAt', 'desc').get();
                gameRooms = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                updateRoomsList();
                
            } catch (error) {
                console.error('Í≤åÏûÑÎ∞© Î°úÎìú Ïò§Î•ò:', error);
                showMessage('Í≤åÏûÑÎ∞© Î°úÎìúÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // Í≤åÏûÑÎ∞© Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
        function updateRoomsList() {
            const listEl = document.getElementById('roomsList');
            
            if (gameRooms.length === 0) {
                listEl.innerHTML = '<div class="message info">ÏÉùÏÑ±Îêú Í≤åÏûÑÎ∞©Ïù¥ ÏóÜÏäµÎãàÎã§.</div>';
                return;
            }
            
            let html = '<div class="rooms-grid">';
            gameRooms.forEach(room => {
                const humanPlayers = room.players ? room.players.filter(p => !p.isAI) : [];
                const aiPlayers = room.players ? room.players.filter(p => p.isAI) : [];
                const statusClass = `status-${room.status || 'waiting'}`;
                const statusText = room.status === 'waiting' ? 'ÎåÄÍ∏∞Ï§ë' : 
                                 room.status === 'playing' ? 'ÏßÑÌñâÏ§ë' : 'Ï¢ÖÎ£å';
                
                html += `
                    <div class="room-card">
                        <div class="room-header">
                            <div class="room-code">${room.roomCode}</div>
                            <div class="room-status ${statusClass}">${statusText}</div>
                        </div>
                        
                        <div class="room-players">
                            ${humanPlayers.map(p => 
                                `<span class="player-name ${p.isHost ? 'host' : ''}">${p.nickname}</span>`
                            ).join('')}
                            ${aiPlayers.map(p => 
                                `<span class="player-name ai">${p.nickname}</span>`
                            ).join('')}
                        </div>
                        
                        <div class="room-info">
                            ÏÉùÏÑ±: ${formatTime(room.createdAt)}
                        </div>
                        ${room.players ? room.players.map(p => 
                            `<div class="room-info" style="font-size: 0.7rem; color: #888;">
                                ${p.nickname}: ${p.cards ? p.cards.map(c => `${c.emoji}${c.number}`).join(' ') : 'Ïπ¥ÎìúÏóÜÏùå'} (${p.score || 0}Ï†ê)
                            </div>`
                        ).join('') : ''}
                        ${room.startedAt ? `<div class="room-info">ÏãúÏûë: ${formatTime(room.startedAt)}</div>` : ''}
                        ${room.status === 'playing' ? `<div class="room-info">ÎùºÏö¥Îìú: ${room.currentRound || 1}</div>` : ''}
                        
                        <div style="margin-top: 15px;">
                            <button class="btn btn-secondary btn-small" onclick="viewRoomDetails('${room.id}')">ÏÉÅÏÑ∏Î≥¥Í∏∞</button>
                            ${room.status === 'finished' ? 
                                `<button class="btn btn-danger btn-small" onclick="deleteRoom('${room.id}')">ÏÇ≠Ï†ú</button>` : ''}
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            listEl.innerHTML = html;
        }

        // Í≤åÏûÑÎ∞© ÏÉÅÏÑ∏Î≥¥Í∏∞
        function viewRoomDetails(roomId) {
            const room = gameRooms.find(r => r.id === roomId);
            if (!room) return;
            
            let details = `Í≤åÏûÑÎ∞©: ${room.roomCode}\n`;
            details += `ÏÉÅÌÉú: ${room.status}\n`;
            details += `Ï∞∏Í∞ÄÏûê Ïàò: ${room.players ? room.players.length : 0}Î™Ö\n`;
            
            if (room.players) {
                details += `\nÏ∞∏Í∞ÄÏûê Î™©Î°ù:\n`;
                room.players.forEach(player => {
                    details += `- ${player.nickname}`;
                    if (player.isHost) details += ' (Î∞©Ïû•)';
                    if (player.isAI) details += ' (AI)';
                    if (player.score) details += ` - ${player.score}Ï†ê`;
                    details += '\n';
                });
            }
            
            if (room.currentMission) {
                details += `\nÌòÑÏû¨ ÎØ∏ÏÖò: ${room.currentMission}`;
            }
            
            alert(details);
        }

        // Í≤åÏûÑÎ∞© ÏÇ≠Ï†ú
        async function deleteRoom(roomId) {
            if (!confirm('Ï†ïÎßêÎ°ú Ïù¥ Í≤åÏûÑÎ∞©ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            
            try {
                await db.collection('games').doc(roomId).delete();
                showMessage('Í≤åÏûÑÎ∞©Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.', 'success');
                loadRooms();
                
            } catch (error) {
                console.error('Í≤åÏûÑÎ∞© ÏÇ≠Ï†ú Ïò§Î•ò:', error);
                showMessage('Í≤åÏûÑÎ∞© ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // ÏôÑÎ£åÎêú Í≤åÏûÑÎ∞© Ï†ïÎ¶¨
        async function cleanupFinishedRooms() {
            if (!confirm('ÏôÑÎ£åÎêú Î™®Îì† Í≤åÏûÑÎ∞©ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            
            try {
                const finishedRooms = gameRooms.filter(room => room.status === 'finished');
                const batch = db.batch();
                
                finishedRooms.forEach(room => {
                    batch.delete(db.collection('games').doc(room.id));
                });
                
                await batch.commit();
                showMessage(`${finishedRooms.length}Í∞úÏùò ÏôÑÎ£åÎêú Í≤åÏûÑÎ∞©Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`, 'success');
                loadRooms();
                
            } catch (error) {
                console.error('Í≤åÏûÑÎ∞© Ï†ïÎ¶¨ Ïò§Î•ò:', error);
                showMessage('Í≤åÏûÑÎ∞© Ï†ïÎ¶¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // Í≤åÏûÑÎ∞© ÏÉàÎ°úÍ≥†Ïπ®
        function refreshRooms() {
            loadRooms();
            showMessage('Í≤åÏûÑÎ∞© Î™©Î°ùÏù¥ ÏÉàÎ°úÍ≥†Ïπ®ÎêòÏóàÏäµÎãàÎã§.', 'info');
        }

        // Í≤åÏûÑ ÏÑ§Ï†ï Î°úÎìú
        function loadSettings() {
            // Í∏∞Î≥∏Í∞íÎì§ÏùÑ UIÏóê ÏÑ§Ï†ï
            document.getElementById('maxPlayers').value = 6;
            document.getElementById('maxRounds').value = 5;
            document.getElementById('autoAI').value = 'true';
            document.getElementById('cardsPerType').value = 5;
        }

        // ÏÑ§Ï†ï ÏóÖÎç∞Ïù¥Ìä∏
        async function updateSetting(settingName) {
            const element = document.getElementById(settingName);
            const value = element.type === 'number' ? parseInt(element.value) : element.value;
            
            try {
                // Í∏ÄÎ°úÎ≤å ÏÑ§Ï†ïÏùÑ FirestoreÏóê Ï†ÄÏû•
                await db.collection('settings').doc('global').set({
                    [settingName]: value,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                
                showMessage(`${settingName} ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.`, 'success');
                
            } catch (error) {
                console.error('ÏÑ§Ï†ï Ï†ÄÏû• Ïò§Î•ò:', error);
                showMessage('ÏÑ§Ï†ï Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞
        async function exportGameData() {
            try {
                const gamesSnapshot = await db.collection('games').get();
                const missionsSnapshot = await db.collection('missions').get();
                
                const exportData = {
                    games: gamesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })),
                    missions: missionsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() })),
                    exportedAt: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `praise-card-game-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showMessage('Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞Í∞Ä ÎÇ¥Î≥¥ÎÇ¥Í∏∞ÎêòÏóàÏäµÎãàÎã§.', 'success');
                
            } catch (error) {
                console.error('Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ïò§Î•ò:', error);
                showMessage('Îç∞Ïù¥ÌÑ∞ ÎÇ¥Î≥¥ÎÇ¥Í∏∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // Ïò§ÎûòÎêú Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨
        async function clearOldData() {
            if (!confirm('30Ïùº Ïù¥Ï†ÑÏùò ÏôÑÎ£åÎêú Í≤åÏûÑÎ∞©ÏùÑ Î™®Îëê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) return;
            
            try {
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                const oldGamesSnapshot = await db.collection('games')
                    .where('status', '==', 'finished')
                    .where('createdAt', '<', thirtyDaysAgo)
                    .get();
                
                const batch = db.batch();
                oldGamesSnapshot.docs.forEach(doc => {
                    batch.delete(doc.ref);
                });
                
                await batch.commit();
                showMessage(`${oldGamesSnapshot.size}Í∞úÏùò Ïò§ÎûòÎêú Í≤åÏûÑÎ∞©Ïù¥ ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`, 'success');
                loadRooms();
                
            } catch (error) {
                console.error('Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨ Ïò§Î•ò:', error);
                showMessage('Îç∞Ïù¥ÌÑ∞ Ï†ïÎ¶¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // Îç∞Ïù¥ÌÑ∞ Î∞±ÏóÖ
        async function backupData() {
            try {
                // ÌòÑÏû¨Îäî ÎÇ¥Î≥¥ÎÇ¥Í∏∞ÏôÄ ÎèôÏùºÌïòÍ≤å Ï≤òÎ¶¨
                await exportGameData();
                showMessage('Îç∞Ïù¥ÌÑ∞Í∞Ä Î∞±ÏóÖÎêòÏóàÏäµÎãàÎã§.', 'success');
                
            } catch (error) {
                console.error('Î∞±ÏóÖ Ïò§Î•ò:', error);
                showMessage('Î∞±ÏóÖÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
            }
        }

        // Ïã§ÏãúÍ∞Ñ Î¶¨Ïä§ÎÑà ÏãúÏûë
        function startRealtimeListener() {
            realtimeListener = db.collection('games')
                .where('status', 'in', ['waiting', 'playing'])
                .onSnapshot((snapshot) => {
                    // ÎåÄÏãúÎ≥¥Îìú ÌÉ≠Ïù¥ ÌôúÏÑ±ÌôîÎêú Í≤ΩÏö∞ÏóêÎßå ÏóÖÎç∞Ïù¥Ìä∏
                    if (document.getElementById('dashboard').classList.contains('active')) {
                        loadDashboard();
                    }
                });
        }

        // ÏãúÍ∞Ñ Ìè¨Îß∑ÌåÖ
        function formatTime(timestamp) {
            if (!timestamp) return 'Ïïå Ïàò ÏóÜÏùå';
            
            let date;
            if (timestamp.toDate) {
                date = timestamp.toDate();
            } else {
                date = new Date(timestamp);
            }
            
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / (1000 * 60));
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (minutes < 1) return 'Î∞©Í∏à Ï†Ñ';
            if (minutes < 60) return `${minutes}Î∂Ñ Ï†Ñ`;
            if (hours < 24) return `${hours}ÏãúÍ∞Ñ Ï†Ñ`;
            if (days < 7) return `${days}Ïùº Ï†Ñ`;
            
            return date.toLocaleDateString('ko-KR');
        }

        // Î©îÏãúÏßÄ ÌëúÏãú
        function showMessage(text, type = 'info') {
            const messageArea = document.getElementById('messageArea');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${type}`;
            messageEl.textContent = text;
            
            messageArea.appendChild(messageEl);
            
            // 5Ï¥à ÌõÑ ÏûêÎèô Ï†úÍ±∞
            setTimeout(() => {
                if (messageEl.parentNode) {
                    messageEl.parentNode.removeChild(messageEl);
                }
            }, 5000);
            
            // Ïä§ÌÅ¨Î°§ÏùÑ Îß® ÏúÑÎ°ú
            window.scrollTo(0, 0);
        }

        // ÌéòÏù¥ÏßÄ Ïñ∏Î°úÎìú Ïãú Î¶¨Ïä§ÎÑà Ï†ïÎ¶¨
        window.addEventListener('beforeunload', function() {
            if (realtimeListener) {
                realtimeListener();
            }
        });

        // Enter ÌÇ§Î°ú ÎØ∏ÏÖò Ï∂îÍ∞Ä
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.id === 'missionText') {
                addMission();
            }
        });

        async function resetAllGames() {
    if (!confirm('Ï†ïÎßêÎ°ú Î™®Îì† Í≤åÏûÑÏùÑ Î¶¨ÏÖãÌïòÏãúÍ≤†ÏäµÎãàÍπå? Ïù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§!')) return;
    if (!confirm('ÏßÑÏßúÎ°ú ÌôïÏã§Ìï©ÎãàÍπå? Î™®Îì† Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎê©ÎãàÎã§!')) return;
    
    try {
        const gamesSnapshot = await db.collection('games').get();
        const batch = db.batch();
        
        gamesSnapshot.docs.forEach(doc => {
            batch.delete(doc.ref);
        });
        
        await batch.commit();
        showMessage(`${gamesSnapshot.size}Í∞úÏùò Í≤åÏûÑÏù¥ Î™®Îëê Î¶¨ÏÖãÎêòÏóàÏäµÎãàÎã§.`, 'success');
        loadRooms();
        loadDashboard();
        
    } catch (error) {
        console.error('Í≤åÏûÑ Î¶¨ÏÖã Ïò§Î•ò:', error);
        showMessage('Í≤åÏûÑ Î¶¨ÏÖãÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.', 'error');
    }
}
    </script>
</body>
</html>
